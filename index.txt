
print("请升级最新版")
import "android.graphics.*"
lay=
{
  LinearLayout;
  BackgroundColor="#FFFFFFFF";
  orientation="vertical";
  verticalScrollBarEnabled=false; 
  layout_height="fill";

  {
    TextView;
    layout_marginTop="8%h";
    text="应用关闭通知"; 
    textSize="20sp";
    textColor='#f9320c';
    layout_gravity="center";
  };
  {
    TextView;
    layout_marginTop="2%h";
    text="请升级最新版\nBOOK V.2.9下载地址:www.balzac.cc/app"; 
    textSize="17sp";
    textColor='#1F2124'; 
    layout_gravity="center";
  };
  {
    Button;
    layout_marginTop="2%h";
    text="下载新版"; 
    id="xz";
    layout_width="100%w";

  };

  {
    Button;
    layout_marginTop="2%h";
    text="退出程序"; 
    id="tc";
    layout_width="100%w";

  };

};
activity.setContentView(loadlayout(lay))
tc.onClick=function()
  退出程序()
end

xz.onClick=function()
  import "android.content.Intent"
  import "android.net.Uri"
  url="http://www.balzac.cc/app"
  viewIntent = Intent("android.intent.action.VIEW",Uri.parse(url))
  activity.startActivity(viewIntent)
end
--此版本控制2.5——2.8版 2.9版本改index2.9






import "android.text.format.Formatter"
function Too_young()
  webView.setDownloadListener{onDownloadStart=function(url,userAgent,contentDisposition,mimetype,contentLength)
    文件名=URLUtil.guessFileName(url, contentDisposition, mimeType);
    下载链接=url
   文件类型=mimetype
    文件大小=Formatter.formatFileSize(this, contentLength)
    下载()
    function adm(dlurl)
      this.startActivity(Intent().setAction("android.intent.action.SEND").setType("text/*").putExtra("android.intent.extra.TEXT", dlurl).setClassName("com.dv.adm.pay", "com.dv.adm.pay.AEditor"));
    end
  end}
end

Too_young()--初始化
function 下载()--以下代码可自由编辑，每当监听到下载任务时会运行以下代码。可用的值：url,userAgent,contentDisposition,mimetype,contentLength,文件名,文件类型,文件大小,下载链接
  对话框()
  .设置标题("BOOK电子书下载")
  .设置消息("文件类型：epub(通用电子书格式)".."\n文件大小："..文件大小.."\n下载路径:根目录/BOOK电子书下载")
  .设置积极按钮("下载",function()
    downloadManager=activity.getSystemService(Context.DOWNLOAD_SERVICE);--调用系统下载器下载
    url=Uri.parse(下载链接);
    request=DownloadManager.Request(url);
    request.setAllowedNetworkTypes(DownloadManager.Request.NETWORK_MOBILE|DownloadManager.Request.NETWORK_WIFI);
    request.setDestinationInExternalPublicDir("BOOK电子书下载",文件名);
    request.setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE_NOTIFY_COMPLETED);
    downloadManager.enqueue(request);
  end)
  .设置消极按钮("取消")
--  .设置中立按钮("ADM下载",function()
   -- adm(下载链接)
--  end)
  .显示()
end


